{"name":"pm-send-next-message","description":"Default description","uuid":"55b1690d-a546-4d33-912c-7f2b83665ef0","resources":[{"values":[{"value":"contentset @contentset","modes":["RICH_MESSAGING"],"content_type":"TEXT","mime_type":"text/plain","language_id":"b262996b-9f64-420e-9e07-941370649939"}],"uuid":"558854d1-b10d-43e0-821e-98e24c856808"},{"values":[{"value":"contentset_item @contentset_item","modes":["RICH_MESSAGING"],"content_type":"TEXT","mime_type":"text/plain","language_id":"b262996b-9f64-420e-9e07-941370649939"}],"uuid":"ea1eb830-0692-4f04-848c-84ce4cbe1860"},{"values":[{"value":"page @page","modes":["RICH_MESSAGING"],"content_type":"TEXT","mime_type":"text/plain","language_id":"b262996b-9f64-420e-9e07-941370649939"}],"uuid":"4cf38c39-840f-4570-b68c-d0b5c7178230"},{"values":[{"value":"@page.body.title\n\n@page.body.body.text.value.message\n","modes":["RICH_MESSAGING"],"content_type":"TEXT","mime_type":"text/plain","language_id":"b262996b-9f64-420e-9e07-941370649939"}],"uuid":"2869d711-a603-460d-a455-31e4e86580b4"}],"flows":[{"label":null,"name":"stack","blocks":[{"label":null,"name":"contentsets","type":"Io.Turn.Webhook","config":{"timeout":5000,"mode":"sync","body":null,"query":[["gender","@contact.gender"],["age","@contact.age"],["relationship","@contact.relationship"]],"url":"https://content-repo-api-qa.prk-k8s.prd-p6t.org/api/v2/orderedcontent/","headers":[["Authorization","Token @global.config.contentrepo_token"]],"method":"GET","cache_ttl":60000},"tags":[],"uuid":"dbac9ec2-01d2-508f-a240-35a681f9c520","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"contentsets","config":{},"test":"","uuid":"5deb4d32-5756-41ca-a86a-b61c683990b5","destination_block":"3c894579-86e8-5648-9c68-408ebc9e6ef5","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":21},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"meta":{"column":3,"line":22},"type":"webhook","webhook":{}},"index":0}}}}}},{"label":null,"name":"contentset","type":"Core.Case","config":{},"tags":[],"uuid":"3c894579-86e8-5648-9c68-408ebc9e6ef5","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"contentsets.body.results[0]","config":{},"test":"","uuid":"beffe596-12c7-46d7-86c2-0330bfdde493","destination_block":"25131a36-ab31-5cf0-b17e-ac6ea41d0263","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":21},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"expression":{},"meta":{"column":3,"line":35},"type":"expression"},"index":0}}}}}},{"label":null,"name":"get_message_log","type":"Core.Log","config":{"message":"558854d1-b10d-43e0-821e-98e24c856808"},"tags":[],"uuid":"25131a36-ab31-5cf0-b17e-ac6ea41d0263","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"get_message_log","config":{},"test":"","uuid":"d0a930be-5340-4ee9-b495-56244e94791c","destination_block":"85a0770f-f213-5c97-8ba8-85baa0289540","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":21},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"log":{},"meta":{"column":3,"line":37},"type":"log"},"index":0}}}}}},{"label":null,"name":"contentset_item","type":"Core.Case","config":{},"tags":[],"uuid":"85a0770f-f213-5c97-8ba8-85baa0289540","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"contentset.pages[push_messaging_content_set_position]","config":{},"test":"","uuid":"03be7d0a-aa93-4018-8046-b7511a0e5c81","destination_block":"e616d211-01d4-5f07-ba39-84be6af786db","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":21},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"expression":{},"meta":{"column":3,"line":39},"type":"expression"},"index":0}}}}}},{"label":null,"name":"get_message_log","type":"Core.Log","config":{"message":"ea1eb830-0692-4f04-848c-84ce4cbe1860"},"tags":[],"uuid":"e616d211-01d4-5f07-ba39-84be6af786db","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"get_message_log","config":{},"test":"","uuid":"10d8e744-d0cb-4ebd-8d0e-8bb8186e4805","destination_block":"0648433f-e886-5484-b0f2-97ed39940c33","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":21},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"log":{},"meta":{"column":3,"line":41},"type":"log"},"index":0}}}}}},{"label":null,"name":"page","type":"Io.Turn.Webhook","config":{"timeout":5000,"mode":"sync","body":null,"query":[["whatsapp","true"]],"url":"https://content-repo-api-qa.prk-k8s.prd-p6t.org/api/v2/pages/@contentset_item.id/","headers":[["Authorization","Token @global.config.contentrepo_token"]],"method":"GET","cache_ttl":60000},"tags":[],"uuid":"0648433f-e886-5484-b0f2-97ed39940c33","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"page","config":{},"test":"","uuid":"fb0da4b0-e205-4339-b452-c22c12ba02a9","destination_block":"a70063f3-22c2-55b5-ad1c-e19d34739d9d","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":21},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"meta":{"column":3,"line":43},"type":"webhook","webhook":{}},"index":0}}}}}},{"label":null,"name":"get_message_log","type":"Core.Log","config":{"message":"4cf38c39-840f-4570-b68c-d0b5c7178230"},"tags":[],"uuid":"a70063f3-22c2-55b5-ad1c-e19d34739d9d","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"Default exit to \"SendMessage\"","config":{},"test":"","uuid":"d72c19cc-c803-479b-8ddd-b7334b5abd7a","destination_block":"4a33bb3c-ce05-5ffc-a22a-aedae889d235","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":21},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"log":{},"meta":{"column":3,"line":52},"type":"log"},"index":0}}}}}},{"label":null,"name":"determine_message_case","type":"Core.Case","config":{},"tags":[],"uuid":"bf5bcec3-e178-5b01-b978-15752029ab5a","ui_metadata":{},"exits":[{"default":false,"name":"Exit for determine_message_case_condition_0","config":{},"test":"and(now() >= datetime_add(contact.push_messaging_signup, 5, \"m\"), now() < datetime_add(contact.push_messaging_signup, 10, \"m\"))","uuid":"11a51081-3b57-40bc-aa73-9c806e465a9d","destination_block":"b7a96e2c-5091-5f8b-8baa-b25f461d5c0c","semantic_label":null,"vendor_metadata":{}},{"default":true,"name":"Exit for determine_message_case_condition_1","config":{},"test":null,"uuid":"ef4b09ef-a0f5-4131-a327-56e94598b949","destination_block":"0bc54330-8f14-52f5-a7a6-d232c81e6ba4","semantic_label":null,"vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{}},{"label":null,"name":"push_messaging_content_set_position","type":"Core.Case","config":{},"tags":[],"uuid":"0bc54330-8f14-52f5-a7a6-d232c81e6ba4","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"1","config":{},"test":"","uuid":"f6bea62c-98de-49d3-a415-15356e125847","destination_block":"dbac9ec2-01d2-508f-a240-35a681f9c520","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":16},"name":"DetermineMessage","uuid":"59296584-a983-57eb-ad8e-77b3bc994dee"},"card_item":{"literal":{},"meta":{"column":3,"line":18},"type":"literal"},"index":1}}}}}},{"label":null,"name":"push_messaging_content_set_position","type":"Core.Case","config":{},"tags":[],"uuid":"b7a96e2c-5091-5f8b-8baa-b25f461d5c0c","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"0","config":{},"test":"","uuid":"cd3b9eb7-cff5-41ca-b273-6856963c2697","destination_block":"dbac9ec2-01d2-508f-a240-35a681f9c520","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":"now() >= datetime_add(contact.push_messaging_signup, 5, \"m\") and now() < datetime_add(contact.push_messaging_signup, 10, \"m\")","meta":{"column":1,"line":6},"name":"DetermineMessage","uuid":"bf5bcec3-e178-5b01-b978-15752029ab5a"},"card_item":{"literal":{},"meta":{"column":3,"line":11},"type":"literal"},"index":0}}}}}},{"label":null,"name":"send_message_case","type":"Core.Case","config":{},"tags":[],"uuid":"4a33bb3c-ce05-5ffc-a22a-aedae889d235","ui_metadata":{},"exits":[{"default":false,"name":"Exit for send_message_case_condition_0","config":{},"test":"page.body.body.is_whatsapp_template","uuid":"dbee2250-426c-47fb-91a4-069988624784","destination_block":"d6a6bacc-b77a-5d5f-a0b8-6928b890d0c9","semantic_label":null,"vendor_metadata":{}},{"default":true,"name":"Exit for send_message_case_condition_1","config":{},"test":null,"uuid":"1841b226-3c87-4294-8a75-e3bd839cfc15","destination_block":"706ac53f-c36d-5a29-af9d-2fd4a5fd9321","semantic_label":null,"vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{}},{"label":null,"name":"message_sent","type":"Core.Output","config":{"value":"\"@page.body.id\""},"tags":[],"uuid":"706ac53f-c36d-5a29-af9d-2fd4a5fd9321","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"message_sent","config":{},"test":"","uuid":"fcc5968a-5b91-4b1a-99c4-6a65a5e42403","destination_block":"31147028-1d40-5e89-845a-327a0ea1835e","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":64},"name":"SendMessage","uuid":"b2c3e2ca-ba63-5954-bcc6-346d54f6e74e"},"card_item":{"meta":{"column":3,"line":65},"type":"write_result","write_result":{}},"index":1}}}}}},{"label":null,"name":"send_message_case_condition_1_text","type":"MobilePrimitives.Message","config":{"prompt":"2869d711-a603-460d-a455-31e4e86580b4"},"tags":[],"uuid":"31147028-1d40-5e89-845a-327a0ea1835e","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"send_message_case_condition_1_text","config":{},"test":"","uuid":"1cf89d88-02e0-444c-8828-c9779c133d33","destination_block":null,"semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":64},"name":"SendMessage","uuid":"b2c3e2ca-ba63-5954-bcc6-346d54f6e74e"},"card_item":{"meta":{"column":3,"line":67},"text":{},"type":"text"},"index":0}}}}}},{"label":null,"name":"template_sent","type":"Core.Output","config":{"value":"\"@page.body.body.whatsapp_template_name\""},"tags":[],"uuid":"d6a6bacc-b77a-5d5f-a0b8-6928b890d0c9","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"template_sent","config":{},"test":"","uuid":"ae7901c7-dd65-4e02-9761-51130e6b2703","destination_block":"9f52cd8a-61bf-5105-8b62-26046e7a6902","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":"page.body.body.is_whatsapp_template","meta":{"column":1,"line":55},"name":"SendMessage","uuid":"4a33bb3c-ce05-5ffc-a22a-aedae889d235"},"card_item":{"meta":{"column":3,"line":56},"type":"write_result","write_result":{}},"index":0}}}}}},{"label":null,"name":"send_message_case_condition_0_whatsapp_template_message","type":"Io.Turn.WhatsAppTemplateMessage","config":{"template":{"name":"\"@page.body.body.whatsapp_template_name\"","language":{"code":"\"en_US\""},"components":[{"index":null,"type":"body","parameters":[{"type":"text","text":"\"@contact.whatsapp_profile_name\""},{"type":"text","text":"\"Second\""}],"sub_type":null}],"tracking":null}},"tags":[],"uuid":"9f52cd8a-61bf-5105-8b62-26046e7a6902","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"send_message_case_condition_0_whatsapp_template_message","config":{},"test":"","uuid":"81eb8384-5e80-4138-8222-15b2c2927971","destination_block":null,"semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":"page.body.body.is_whatsapp_template","meta":{"column":1,"line":55},"name":"SendMessage","uuid":"4a33bb3c-ce05-5ffc-a22a-aedae889d235"},"card_item":{"meta":{"column":3,"line":58},"type":"whatsapp_template_message","whatsapp_template_message":{}},"index":0}}}}}}],"last_modified":"2024-10-17T14:34:53.741200Z","uuid":"cd151682-0f27-58a0-a7b3-281620f3513d","languages":[{"id":"b262996b-9f64-420e-9e07-941370649939","label":"English","variant":null,"iso_639_3":"eng","bcp_47":null}],"first_block_id":"bf5bcec3-e178-5b01-b978-15752029ab5a","interaction_timeout":300,"vendor_metadata":{},"supported_modes":["RICH_MESSAGING"],"exit_block_id":""}],"vendor_metadata":{},"specification_version":"1.0.0-rc3"}