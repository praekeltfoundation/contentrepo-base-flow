{"name":"pm-send-next-message","description":"Default description","uuid":"55b1690d-a546-4d33-912c-7f2b83665ef0","resources":[{"values":[{"value":"@page.body.title\n\n@page.body.body.text.value.message\n","modes":["RICH_MESSAGING"],"content_type":"TEXT","mime_type":"text/plain","language_id":"248f684f-005e-49e8-a567-072ea71d3a8a"}],"uuid":"085fb255-222f-44e4-82e1-baa654437922"}],"flows":[{"label":null,"name":"stack","blocks":[{"label":null,"name":"send_message_case","type":"Core.Case","config":{},"tags":[],"uuid":"4a33bb3c-ce05-5ffc-a22a-aedae889d235","ui_metadata":{},"exits":[{"default":false,"name":"Exit for send_message_case_condition_0","config":{},"test":"page.body.body.is_whatsapp_template","uuid":"3066c9b1-294a-4e1a-80e9-cd5a7328ca9c","destination_block":"bd67ea29-74a9-57db-b900-1beac600c99d","semantic_label":null,"vendor_metadata":{}},{"default":true,"name":"Exit for send_message_case_condition_1","config":{},"test":null,"uuid":"15c36c7a-13f8-4dc8-8265-5356e7989303","destination_block":"0653cac5-4125-50a2-b335-1c1a9c9439c4","semantic_label":null,"vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{}},{"label":null,"name":"message_sent","type":"Core.Output","config":{"value":"\"@page.body.id\""},"tags":[],"uuid":"0653cac5-4125-50a2-b335-1c1a9c9439c4","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"message_sent","config":{},"test":"","uuid":"909777bc-0bb7-41ad-ac4b-fb05243dbdd0","destination_block":"8b939f5b-ac37-5a69-b67d-a160209775a8","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":87},"name":"SendMessage","uuid":"b2c3e2ca-ba63-5954-bcc6-346d54f6e74e"},"card_item":{"meta":{"column":3,"line":88},"type":"write_result","write_result":{}},"index":1}}}}}},{"label":null,"name":"send_message_case_condition_1_text","type":"MobilePrimitives.Message","config":{"prompt":"085fb255-222f-44e4-82e1-baa654437922"},"tags":[],"uuid":"8b939f5b-ac37-5a69-b67d-a160209775a8","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"send_message_case_condition_1_text","config":{},"test":"","uuid":"7401eff7-3221-4e00-9b19-9b37d63b8acd","destination_block":null,"semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":87},"name":"SendMessage","uuid":"b2c3e2ca-ba63-5954-bcc6-346d54f6e74e"},"card_item":{"meta":{"column":3,"line":90},"text":{},"type":"text"},"index":0}}}}}},{"label":null,"name":"template_sent","type":"Core.Output","config":{"value":"\"@page.body.body.whatsapp_template_name\""},"tags":[],"uuid":"bd67ea29-74a9-57db-b900-1beac600c99d","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"template_sent","config":{},"test":"","uuid":"73eb97ad-ddd2-49a8-aa70-4565256717de","destination_block":"b295e1ff-ce5e-51db-9528-16246c1ed8fa","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":"page.body.body.is_whatsapp_template","meta":{"column":1,"line":78},"name":"SendMessage","uuid":"4a33bb3c-ce05-5ffc-a22a-aedae889d235"},"card_item":{"meta":{"column":3,"line":79},"type":"write_result","write_result":{}},"index":0}}}}}},{"label":null,"name":"send_message_case_condition_0_whatsapp_template_message","type":"Io.Turn.WhatsAppTemplateMessage","config":{"template":{"name":"\"@page.body.body.whatsapp_template_name\"","components":[{"index":null,"type":"body","parameters":[{"type":"text","text":"\"@contact.whatsapp_profile_name\""},{"type":"text","text":"\"Second\""}],"sub_type":null}],"language":{"code":"\"en_US\""},"tracking":null}},"tags":[],"uuid":"b295e1ff-ce5e-51db-9528-16246c1ed8fa","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"send_message_case_condition_0_whatsapp_template_message","config":{},"test":"","uuid":"cfc8e9ee-1cf7-4e00-b9d0-b8d797dcec7c","destination_block":null,"semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":"page.body.body.is_whatsapp_template","meta":{"column":1,"line":78},"name":"SendMessage","uuid":"4a33bb3c-ce05-5ffc-a22a-aedae889d235"},"card_item":{"meta":{"column":3,"line":81},"type":"whatsapp_template_message","whatsapp_template_message":{}},"index":0}}}}}},{"label":null,"name":"contentsets","type":"Io.Turn.Webhook","config":{"timeout":5000,"mode":"sync","body":null,"query":[["gender","@contact.gender"],["age","@age_range"],["relationship","@contact.relationship_status"]],"url":"https://content-repo-api-qa.prk-k8s.prd-p6t.org/api/v2/orderedcontent/","headers":[["Authorization","Token @global.config.contentrepo_token"]],"method":"GET","cache_ttl":60000},"tags":[],"uuid":"f85a3051-65de-50ae-b66f-88435574da02","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"contentsets","config":{},"test":"","uuid":"55e9ce5c-4666-4aa0-a752-2ece27f7f471","destination_block":"b3d4494d-6566-55de-b7b1-3c9e3f9c190a","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":50},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"meta":{"column":3,"line":51},"type":"webhook","webhook":{}},"index":0}}}}}},{"label":null,"name":"contentset","type":"Core.Case","config":{},"tags":[],"uuid":"b3d4494d-6566-55de-b7b1-3c9e3f9c190a","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"contentsets.body.results[0]","config":{},"test":"","uuid":"7524505e-da97-4650-b35c-ed132c099c06","destination_block":"6f89661d-0a3f-5bea-849e-2aaf3475d136","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":50},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"expression":{},"meta":{"column":3,"line":64},"type":"expression"},"index":0}}}}}},{"label":null,"name":"contentset_item","type":"Core.Case","config":{},"tags":[],"uuid":"6f89661d-0a3f-5bea-849e-2aaf3475d136","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"contentset.pages[push_messaging_content_set_position]","config":{},"test":"","uuid":"28af9ccd-0edc-4499-a9ff-eee30177a1cf","destination_block":"c4968226-2322-5be4-9f4d-883bf37c5004","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":50},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"expression":{},"meta":{"column":3,"line":66},"type":"expression"},"index":0}}}}}},{"label":null,"name":"page","type":"Io.Turn.Webhook","config":{"timeout":5000,"mode":"sync","body":null,"query":[["whatsapp","true"]],"url":"https://content-repo-api-qa.prk-k8s.prd-p6t.org/api/v2/pages/@contentset_item.id/","headers":[["Authorization","Token @global.config.contentrepo_token"]],"method":"GET","cache_ttl":60000},"tags":[],"uuid":"c4968226-2322-5be4-9f4d-883bf37c5004","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"Default exit to \"SendMessage\"","config":{},"test":"","uuid":"55ab551f-20a1-43d5-8d54-cd75451c25d7","destination_block":"4a33bb3c-ce05-5ffc-a22a-aedae889d235","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":50},"name":"GetMessage","uuid":"6f4f7f0b-c111-5248-8be2-104e696b4eeb"},"card_item":{"meta":{"column":3,"line":68},"type":"webhook","webhook":{}},"index":0}}}}}},{"label":null,"name":"determine_age_range_case","type":"Core.Case","config":{},"tags":[],"uuid":"4693f64a-a63a-533d-be3a-ed5d3bf3b09a","ui_metadata":{},"exits":[{"default":false,"name":"Exit for determine_age_range_case_condition_0","config":{},"test":"and(age >= 15, age <= 18)","uuid":"36b1cfca-9540-47fc-8661-d9b4ff5ced8d","destination_block":"9a65ffbb-f616-59a0-a519-0ec008fcc5a7","semantic_label":null,"vendor_metadata":{}},{"default":false,"name":"Exit for determine_age_range_case_condition_1","config":{},"test":"and(age >= 25, age <= 30)","uuid":"69acfc8c-ae13-41f0-beae-5c36f6207779","destination_block":"bfaacd08-57b5-57a0-a215-5d65553f2bc3","semantic_label":null,"vendor_metadata":{}},{"default":true,"name":"Exit for determine_age_range_case_condition_2","config":{},"test":null,"uuid":"d3ebf181-54f5-4d29-9099-c4681263355b","destination_block":"0b45d8e6-4cf8-5158-a770-d331adb4ba3d","semantic_label":null,"vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{}},{"label":null,"name":"age_range","type":"Core.Case","config":{},"tags":[],"uuid":"0b45d8e6-4cf8-5158-a770-d331adb4ba3d","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"\"\"","config":{},"test":"","uuid":"aa34615f-0bc8-4fe9-898d-5ff3d92a6580","destination_block":"f85a3051-65de-50ae-b66f-88435574da02","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":46},"name":"DetermineAgeRange","uuid":"0eb1372c-ccc7-54fe-be99-539a4d72659c"},"card_item":{"literal":{},"meta":{"column":3,"line":47},"type":"literal"},"index":2}}}}}},{"label":null,"name":"age_range","type":"Core.Case","config":{},"tags":[],"uuid":"bfaacd08-57b5-57a0-a215-5d65553f2bc3","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"\"25 - 30\"","config":{},"test":"","uuid":"3a8a60dc-474f-4989-b73d-ecff96ba8679","destination_block":"f85a3051-65de-50ae-b66f-88435574da02","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":"age >= 25 and age <= 30","meta":{"column":1,"line":42},"name":"DetermineAgeRange","uuid":"a5caae72-e322-5ec3-82d1-e395dc3a507c"},"card_item":{"literal":{},"meta":{"column":3,"line":43},"type":"literal"},"index":1}}}}}},{"label":null,"name":"age_range","type":"Core.Case","config":{},"tags":[],"uuid":"9a65ffbb-f616-59a0-a519-0ec008fcc5a7","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"\"15 - 18\"","config":{},"test":"","uuid":"f0f8380c-f719-4027-b887-1cd64c1a66e8","destination_block":"f85a3051-65de-50ae-b66f-88435574da02","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":"age >= 15 and age <= 18","meta":{"column":1,"line":38},"name":"DetermineAgeRange","uuid":"4693f64a-a63a-533d-be3a-ed5d3bf3b09a"},"card_item":{"literal":{},"meta":{"column":3,"line":39},"type":"literal"},"index":0}}}}}},{"label":null,"name":"age","type":"Core.Case","config":{},"tags":[],"uuid":"48bb0531-d96f-593c-81fb-1ad12d44742e","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"if(is_nil_or_empty(contact.year_of_birth), 0, year(now()) - contact.year_of_birth)","config":{},"test":"","uuid":"9f1bc2ee-1ae5-46dd-9222-b6847c9ba0b9","destination_block":"4693f64a-a63a-533d-be3a-ed5d3bf3b09a","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":21},"name":"CalculateAge","uuid":"c26d6e5f-ae37-5937-ba8d-bc9408d944b2"},"card_item":{"expression":{},"meta":{"column":3,"line":30},"type":"expression"},"index":0}}}}}},{"label":null,"name":"determine_message_case","type":"Core.Case","config":{},"tags":[],"uuid":"bf5bcec3-e178-5b01-b978-15752029ab5a","ui_metadata":{},"exits":[{"default":false,"name":"Exit for determine_message_case_condition_0","config":{},"test":"and(now() >= datetime_add(contact.push_messaging_signup, 5, \"m\"), now() < datetime_add(contact.push_messaging_signup, 10, \"m\"))","uuid":"742c9ca0-9a2f-4e63-b02b-b24a126d8f47","destination_block":"b7a96e2c-5091-5f8b-8baa-b25f461d5c0c","semantic_label":null,"vendor_metadata":{}},{"default":true,"name":"Exit for determine_message_case_condition_1","config":{},"test":null,"uuid":"64b2aca4-16d9-49ee-9f51-f7566b9f9eae","destination_block":"0bc54330-8f14-52f5-a7a6-d232c81e6ba4","semantic_label":null,"vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{}},{"label":null,"name":"push_messaging_content_set_position","type":"Core.Case","config":{},"tags":[],"uuid":"0bc54330-8f14-52f5-a7a6-d232c81e6ba4","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"1","config":{},"test":"","uuid":"bf4ed9d5-bacb-4725-b0db-7cdcf619b56a","destination_block":"48bb0531-d96f-593c-81fb-1ad12d44742e","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":null,"meta":{"column":1,"line":16},"name":"DetermineMessage","uuid":"59296584-a983-57eb-ad8e-77b3bc994dee"},"card_item":{"literal":{},"meta":{"column":3,"line":18},"type":"literal"},"index":1}}}}}},{"label":null,"name":"push_messaging_content_set_position","type":"Core.Case","config":{},"tags":[],"uuid":"b7a96e2c-5091-5f8b-8baa-b25f461d5c0c","ui_metadata":{"canvas_coordinates":{"x":0,"y":0}},"exits":[{"default":true,"name":"0","config":{},"test":"","uuid":"c5b15e3f-fc9c-4a5e-8680-d393932c8e26","destination_block":"48bb0531-d96f-593c-81fb-1ad12d44742e","semantic_label":"","vendor_metadata":{}}],"semantic_label":null,"vendor_metadata":{"io":{"turn":{"stacks_dsl":{"0.1.0":{"card":{"condition":"now() >= datetime_add(contact.push_messaging_signup, 5, \"m\") and now() < datetime_add(contact.push_messaging_signup, 10, \"m\")","meta":{"column":1,"line":6},"name":"DetermineMessage","uuid":"bf5bcec3-e178-5b01-b978-15752029ab5a"},"card_item":{"literal":{},"meta":{"column":3,"line":11},"type":"literal"},"index":0}}}}}}],"last_modified":"2024-10-28T13:24:32.891241Z","uuid":"cd151682-0f27-58a0-a7b3-281620f3513d","languages":[{"id":"248f684f-005e-49e8-a567-072ea71d3a8a","label":"English","variant":null,"iso_639_3":"eng","bcp_47":null}],"first_block_id":"bf5bcec3-e178-5b01-b978-15752029ab5a","interaction_timeout":300,"vendor_metadata":{},"supported_modes":["RICH_MESSAGING"],"exit_block_id":""}],"vendor_metadata":{},"specification_version":"1.0.0-rc3"}